<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Force Layout with labels on edges</title>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<style type="text/css">
</style>
</head>
<body>

<script type="text/javascript">

    var w = 2000;
    var h = 3000;
    var linkDistance=250;

    var colors = d3.scale.ordinal().range(["#1f77b4"]);
	
    var dataset = {

    nodes: [
    {name: "21 CFR PART 11"},
	{name: "General Provisions"},
    {name: "Electronic Records"},
    {name: "Electronic Signatures"},
    {name: "11.1 Scope"},
    {name: "11.2 Implementation"},
    {name: "11.3 Definitions"},
    {name: "11.10 Controls for closed systems."},
    {name: "11.30 Controls for open systems"},
    {name: "11.50 Signature manifestations"},
    {name: "11.70 Signature/record linking"},
	{name: "11.100 General requirements"},
	{name: "11.200 Electronic signature components and controls"},
	{name: "11.300 Controls for identification codes/passwords"},
	{name: "electronic form"},
	{name: "handwritten signature"},
	{name: "agency regulation"},
	{name: "electronic signature"},
	{name: "electronic record"},
	{name: "paper record"},
	{name: "cosmetic act"},
	{name: "computer system"},
	{name: "electronic mean"},
	{name: "fda inspection"},
	{name: "federal food"},
	{name: "electronic form"},
	{name: "electronic submission"},
	{name: "paper record"},
	{name: "electronic record"},
	{name: "electronic signature"},
	{name: "traditional signature"},
	{name: "paper form"},
	{name: "file format"},
	{name: "handwritten signature"},
	{name: "electronic record"},
	{name: "agency"},
	{name: "digital form"},
	{name: "cosmetic act"},
	{name: "act"},
	{name: "computer system"},
	{name: "biometrics"},
	{name: "information representation"},
	{name: "federal food"},
	{name: "repeatable action"},
	{name: "cryptographic method"},	
	{name: "originator authentication"},
	{name: "electronic signature"},
	{name: "close system"},
	{name: "electronic record"},
	{name: "alter record"},
	{name: "sign record"},
	{name: "system documentation"},
	{name: "agency review"},
	{name: "signature falsification"},
	{name: "human readable"},
	{name: "record change"},
	{name: "deter record"},
	{name: "adequate control"},
	{name: "system operation"},
	{name: "electronically sign"},
	{name: "authorize individual"},
	{name: "output device"},
	{name: "data input"},
	{name: "operational instruction"},
	{name: "appropriate control"},
	{name: "complete copy"},
	{name: "readily repudiate"},
	{name: "document time"},
	{name: "audit trail"},
	{name: "operator entr"},
	{name: "employ procedure"},
	{name: "ensure accuracy"},
	{name: "authority check"},
	{name: "electronic record"},
	{name: "record authenticity"},
	{name: "document encryption"},
	{name: "additional measure"},
	{name: "control"},
	{name: "electronic record"},
	{name: "signature manifestation"},
	{name: "electronic display"},
	{name: "print name"},
	{name: "electronic record"},
	{name: "electronic signature"},
	{name: "signature/record link"},
	{name: "handwritten signature"},
	{name: "electronic signature"},
	{name: "agency request"},
	{name: "paper form"},
	{name: "regional operation"},
	{name: "identification code"},
	{name: "electronic signature"},
	{name: "genuine owner"},
	{name: "subsequent signing"},
	{name: "continuous period"},
	{name: "identification code"},
	{name: "password information"},
	{name: "password age"},
	{name: "password issuance"},
	{name: "rigorous control"},
	{name: "employ control"},
	{name: "issue temporary"},
	{name: "identification codes/passwords"},
	{name: "organizational management"},
	{name: "periodic test"},
	{name: "periodically check"},
	{name: "transaction safeguard"},
	{name: "function properly"},
	
    ],
    edges: [
    {source: 0, target: 1},
    {source: 0, target: 2},
    {source: 0, target: 3},
    {source: 1, target: 4},
	{source: 1, target: 5},
	{source: 1, target: 6},
	{source: 2, target: 7},
	{source: 2, target: 8},
	{source: 2, target: 9},
	{source: 2, target: 10},
	{source: 3, target: 11},
	{source: 3, target: 12},
	{source: 3, target: 13},
	{source: 4, target: 14},
	{source: 4, target: 15},
	{source: 4, target: 16},
	{source: 4, target: 17},
	{source: 4, target: 18},
	{source: 4, target: 19},
	{source: 4, target: 20},
	{source: 4, target: 21},
	{source: 4, target: 22},
	{source: 4, target: 23},
	{source: 4, target: 24},
	{source: 4, target: 25},
	{source: 4, target: 26},
	{source: 5, target: 27},
	{source: 5, target: 28},
	{source: 5, target: 29},
	{source: 5, target: 30},
	{source: 5, target: 31},
	{source: 5, target: 32},	
	{source: 6, target: 33},
	{source: 6, target: 34},
	{source: 6, target: 35},
	{source: 6, target: 36},
	{source: 6, target: 37},
	{source: 6, target: 38},
	{source: 6, target: 39},
	{source: 6, target: 40},
	{source: 6, target: 41},
	{source: 6, target: 42},
	{source: 6, target: 43},
	{source: 6, target: 44},
	{source: 6, target: 45},
	{source: 7, target: 46},
	{source: 7, target: 47},
	{source: 7, target: 48},
	{source: 7, target: 49},
	{source: 7, target: 50},
	{source: 7, target: 51},
	{source: 7, target: 52},
	{source: 7, target: 53},
	{source: 7, target: 54},
	{source: 7, target: 55},
	{source: 7, target: 56},
	{source: 7, target: 57},
	{source: 7, target: 58},
	{source: 7, target: 59},
	{source: 7, target: 60},
	{source: 7, target: 61},
	{source: 7, target: 62},
	{source: 7, target: 63},
	{source: 7, target: 64},
	{source: 7, target: 65},
	{source: 7, target: 66},
	{source: 7, target: 67},
	{source: 7, target: 68},
	{source: 7, target: 69},
	{source: 7, target: 70},
	{source: 7, target: 71},
	{source: 7, target: 72},
	{source: 8, target: 73},
	{source: 8, target: 74},
	{source: 8, target: 75},
	{source: 8, target: 76},
	{source: 8, target: 77},
	{source: 9, target: 78},
	{source: 9, target: 79},
	{source: 9, target: 80},
	{source: 9, target: 81},
	{source: 10, target: 82},
	{source: 10, target: 83},
	{source: 10, target: 84},
	{source: 11, target: 85},
	{source: 11, target: 86},
	{source: 11, target: 87},
	{source: 11, target: 88},
	{source: 11, target: 89},
	{source: 12, target: 90},
	{source: 12, target: 91},
	{source: 12, target: 92},
	{source: 12, target: 93},
	{source: 12, target: 94},
	{source: 13, target: 95},
	{source: 13, target: 96},
	{source: 13, target: 97},
	{source: 13, target: 98},
	{source: 13, target: 99},
	{source: 13, target: 100},
	{source: 13, target: 101},
	{source: 13, target: 102},
	{source: 13, target: 103},
	{source: 13, target: 104},
	{source: 13, target: 105},
	{source: 13, target: 106},
	{source: 13, target: 107}
	
	
	
    ]
    };

 
    var svg = d3.select("body").append("svg").attr({"width":w,"height":h});

    var force = d3.layout.force()
        .nodes(dataset.nodes)
        .links(dataset.edges)
        .size([w,h])
        .linkDistance([linkDistance])
        .charge([-500])
        .theta(0.1)
        .gravity(0.05)
        .start();

 

    var edges = svg.selectAll("line")
      .data(dataset.edges)
      .enter()
      .append("line")
      .attr("id",function(d,i) {return 'edge'+i})
      .attr('marker-end','url(#arrowhead)')
      .style("stroke","#ccc")
      .style("pointer-events", "none");
    
    var nodes = svg.selectAll("circle")
      .data(dataset.nodes)
      .enter()
      .append("circle")
      .attr({"r":15})
      .style("fill",function(d,i){return colors(i);})
      .call(force.drag)


    var nodelabels = svg.selectAll(".nodelabel") 
       .data(dataset.nodes)
       .enter()
       .append("text")
       .attr({"x":function(d){return d.x;},
              "y":function(d){return d.y;},
              "class":"nodelabel",
              "stroke":"black"})
       .text(function(d){return d.name;});

    var edgepaths = svg.selectAll(".edgepath")
        .data(dataset.edges)
        .enter()
        .append('path')
        .attr({'d': function(d) {return 'M '+d.source.x+' '+d.source.y+' L '+ d.target.x +' '+d.target.y},
               'class':'edgepath',
               'fill-opacity':0,
               'stroke-opacity':0,
               'fill':'blue',
               'stroke':'red',
               'id':function(d,i) {return 'edgepath'+i}})
        .style("pointer-events", "none");

    var edgelabels = svg.selectAll(".edgelabel")
        .data(dataset.edges)
        .enter()
        .append('text')
        .style("pointer-events", "none")
        .attr({'class':'edgelabel',
               'id':function(d,i){return 'edgelabel'+i},
               'dx':80,
               'dy':0,
               'font-size':20,
               'fill':'#aaa'});

    edgelabels.append('textPath')
        .attr('xlink:href',function(d,i) {return '#edgepath'+i})
        .style("pointer-events", "none");


    svg.append('defs').append('marker')
        .attr({'id':'arrowhead',
               'viewBox':'-0 -5 10 10',
               'refX':25,
               'refY':0,
               //'markerUnits':'strokeWidth',
               'orient':'auto',
               'markerWidth':10,
               'markerHeight':10,
               'xoverflow':'visible'})
        .append('svg:path')
            .attr('d', 'M 0,-5 L 10 ,0 L 0,5')
            .attr('fill', '#ccc')
            .attr('stroke','#ccc');
     

    force.on("tick", function(){

        edges.attr({"x1": function(d){return d.source.x;},
                    "y1": function(d){return d.source.y;},
                    "x2": function(d){return d.target.x;},
                    "y2": function(d){return d.target.y;}
        });

        nodes.attr({"cx":function(d){return d.x;},
                    "cy":function(d){return d.y;}
        });

        nodelabels.attr("x", function(d) { return d.x; }) 
                  .attr("y", function(d) { return d.y; });

        edgepaths.attr('d', function(d) { var path='M '+d.source.x+' '+d.source.y+' L '+ d.target.x +' '+d.target.y;
                                           //console.log(d)
                                           return path});       

        edgelabels.attr('transform',function(d,i){
            if (d.target.x<d.source.x){
                bbox = this.getBBox();
                rx = bbox.x+bbox.width/2;
                ry = bbox.y+bbox.height/2;
                return 'rotate(180 '+rx+' '+ry+')';
                }
            else {
                return 'rotate(0)';
                }
        });
    });

</script>

</body>
</html>